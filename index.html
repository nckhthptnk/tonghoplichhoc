<!doctype html>
<html lang="vi">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trang T·ªïng h·ª£p D·ªØ li·ªáu</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100%;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 700;
        }

        .status-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .status-badge {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .status-waiting {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffeaa7;
        }

        .status-received {
            background: #d1ecf1;
            color: #0c5460;
            border: 2px solid #bee5eb;
        }

        .status-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .icon-waiting {
            background: #ffc107;
            animation: pulse 2s infinite;
        }

        .icon-received {
            background: #28a745;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .content {
            padding: 30px;
        }

        .data-preview {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .preview-card {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            background: #f8f9fa;
        }

        .preview-card h3 {
            margin: 0 0 15px 0;
            color: #495057;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .preview-content {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
            max-height: 300px;
            overflow-y: auto;
        }

        .data-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f1f3f4;
        }

        .data-item:last-child {
            border-bottom: none;
        }

        .data-key {
            font-weight: 600;
            color: #495057;
        }

        .data-value {
            color: #6c757d;
            text-align: right;
            max-width: 200px;
            word-wrap: break-word;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(86, 171, 47, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .file-upload {
            margin-bottom: 20px;
            padding: 20px;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            text-align: center;
            background: #f8f9fa;
        }

        .file-input {
            margin: 10px;
            padding: 8px 15px;
            border: 1px solid #ced4da;
            border-radius: 5px;
        }

        #export-area {
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin-top: 20px;
            border: 2px solid #e9ecef;
        }

        .export-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .export-table th,
        .export-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .export-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        .export-table tr:hover {
            background: #f8f9fa;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        @media (max-width: 768px) {
            .data-preview {
                grid-template-columns: 1fr;
            }
            
            .status-bar {
                flex-direction: column;
                align-items: center;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="container">
   <div class="header">
    <h1 id="page-title">Trang T·ªïng h·ª£p D·ªØ li·ªáu</h1>
    <p>Nh·∫≠n v√† t·ªïng h·ª£p d·ªØ li·ªáu t·ª´ c√°c trang ngu·ªìn</p>
   </div>
   <div class="status-bar">
    <div class="status-badge status-waiting" id="status-lichtrinhcanhan">
     <div class="status-icon icon-waiting"></div><span>L·ªãch tr√¨nh c√° nh√¢n: ƒêang ch·ªù...</span>
    </div>
    <div class="status-badge status-waiting" id="status-tkbnk2526hs">
     <div class="status-icon icon-waiting"></div><span>TKBNK 2526HS: ƒêang ch·ªù...</span>
    </div>
   </div>
   <div class="content">
    <div class="file-upload">
     <h3>üìÅ Fallback: T·∫£i file JSON th·ªß c√¥ng</h3>
     <p>N·∫øu kh√¥ng nh·∫≠n ƒë∆∞·ª£c d·ªØ li·ªáu t·ª± ƒë·ªông, b·∫°n c√≥ th·ªÉ t·∫£i file JSON:</p><input type="file" id="file-lichtrinhcanhan" class="file-input" accept=".json"> <label>L·ªãch tr√¨nh c√° nh√¢n</label> <input type="file" id="file-tkbnk2526hs" class="file-input" accept=".json"> <label>TKBNK 2526HS</label>
    </div>
    <div class="data-preview">
     <div class="preview-card">
      <h3>üìÖ L·ªãch tr√¨nh c√° nh√¢n <span id="timestamp-lichtrinhcanhan" style="font-size: 0.8rem; color: #6c757d;"></span></h3>
      <div class="preview-content" id="preview-lichtrinhcanhan">
       <div class="empty-state">
        <svg viewbox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
        </svg>
        <p>Ch∆∞a nh·∫≠n ƒë∆∞·ª£c d·ªØ li·ªáu</p>
       </div>
      </div>
     </div>
     <div class="preview-card">
      <h3>üìö TKBNK 2526HS <span id="timestamp-tkbnk2526hs" style="font-size: 0.8rem; color: #6c757d;"></span></h3>
      <div class="preview-content" id="preview-tkbnk2526hs">
       <div class="empty-state">
        <svg viewbox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
        </svg>
        <p>Ch∆∞a nh·∫≠n ƒë∆∞·ª£c d·ªØ li·ªáu</p>
       </div>
      </div>
     </div>
    </div>
    <div class="controls"><button class="btn btn-primary" id="btn-aggregate" disabled> üîÑ T·ªïng h·ª£p l·∫°i </button> <button class="btn btn-success" id="btn-export" disabled> üì∏ Xu·∫•t PNG </button>
    </div>
    <div id="export-area" style="display: none;">
     <h2>üìä B·∫£ng T·ªïng h·ª£p D·ªØ li·ªáu</h2>
     <p id="export-timestamp"></p>
     <table class="export-table" id="export-table">
      <thead>
       <tr>
        <th>Ngu·ªìn</th>
        <th>Tr∆∞·ªùng d·ªØ li·ªáu</th>
        <th>Gi√° tr·ªã</th>
       </tr>
      </thead>
      <tbody id="export-tbody">
      </tbody>
     </table>
    </div>
   </div>
  </div>
  <script>
        // C·∫•u h√¨nh m·∫∑c ƒë·ªãnh
        const defaultConfig = {
            page_title: "Trang T·ªïng h·ª£p D·ªØ li·ªáu",
            export_filename: "tonghop-dulieu"
        };

        // Whitelist origins
        const ALLOWED_ORIGINS = [
            'https://nckhthptnk.github.io',
            'https://tkbnkhoahung.github.io'
        ];

        // L∆∞u tr·ªØ d·ªØ li·ªáu nh·∫≠n ƒë∆∞·ª£c
        let receivedData = {
            lichtrinhcanhan: null,
            tkbnk2526hs: null
        };

        // Kh·ªüi t·∫°o Element SDK
        async function initializeSDK() {
            if (window.elementSdk) {
                await window.elementSdk.init({
                    defaultConfig,
                    onConfigChange: async (config) => {
                        document.getElementById('page-title').textContent = 
                            config.page_title || defaultConfig.page_title;
                    },
                    mapToCapabilities: (config) => ({
                        recolorables: [],
                        borderables: [],
                        fontEditable: undefined,
                        fontSizeable: undefined
                    }),
                    mapToEditPanelValues: (config) => new Map([
                        ['page_title', config.page_title || defaultConfig.page_title],
                        ['export_filename', config.export_filename || defaultConfig.export_filename]
                    ])
                });
            }
        }

        // L·∫Øng nghe tin nh·∫Øn t·ª´ c√°c trang ngu·ªìn
        window.addEventListener('message', function(event) {
            // Ki·ªÉm tra origin whitelist
            if (!ALLOWED_ORIGINS.includes(event.origin)) {
                console.warn('T·ª´ ch·ªëi tin nh·∫Øn t·ª´ origin kh√¥ng ƒë∆∞·ª£c ph√©p:', event.origin);
                return;
            }

            const message = event.data;
            
            // Ki·ªÉm tra ƒë·ªãnh d·∫°ng tin nh·∫Øn
            if (message.type === 'TKB_DATA' && message.source && message.data) {
                console.log('Nh·∫≠n ƒë∆∞·ª£c d·ªØ li·ªáu t·ª´:', message.source);
                
                // L∆∞u d·ªØ li·ªáu
                receivedData[message.source] = message;
                
                // C·∫≠p nh·∫≠t UI
                updateStatus(message.source, true);
                updatePreview(message.source, message.data, message.timestamp);
                updateControls();
            }
        });

        // C·∫≠p nh·∫≠t tr·∫°ng th√°i nh·∫≠n d·ªØ li·ªáu
        function updateStatus(source, received) {
            const statusElement = document.getElementById(`status-${source}`);
            const iconElement = statusElement.querySelector('.status-icon');
            
            if (received) {
                statusElement.className = 'status-badge status-received';
                statusElement.querySelector('span').textContent = 
                    source === 'lichtrinhcanhan' ? 'L·ªãch tr√¨nh c√° nh√¢n: ƒê√£ nh·∫≠n ‚úì' : 'TKBNK 2526HS: ƒê√£ nh·∫≠n ‚úì';
                iconElement.className = 'status-icon icon-received';
            }
        }

        // C·∫≠p nh·∫≠t preview d·ªØ li·ªáu
        function updatePreview(source, data, timestamp) {
            const previewElement = document.getElementById(`preview-${source}`);
            const timestampElement = document.getElementById(`timestamp-${source}`);
            
            // Hi·ªÉn th·ªã timestamp
            if (timestamp) {
                const date = new Date(timestamp);
                timestampElement.textContent = `(${date.toLocaleString('vi-VN')})`;
            }
            
            // Hi·ªÉn th·ªã d·ªØ li·ªáu
            let html = '';
            for (const [key, value] of Object.entries(data)) {
                html += `
                    <div class="data-item">
                        <span class="data-key">${key}:</span>
                        <span class="data-value">${value}</span>
                    </div>
                `;
            }
            
            previewElement.innerHTML = html;
        }

        // C·∫≠p nh·∫≠t tr·∫°ng th√°i c√°c n√∫t ƒëi·ªÅu khi·ªÉn
        function updateControls() {
            const hasData = receivedData.lichtrinhcanhan || receivedData.tkbnk2526hs;
            document.getElementById('btn-aggregate').disabled = !hasData;
            document.getElementById('btn-export').disabled = !hasData;
        }

        // X·ª≠ l√Ω t·ªïng h·ª£p d·ªØ li·ªáu
        document.getElementById('btn-aggregate').addEventListener('click', function() {
            const exportArea = document.getElementById('export-area');
            const exportTable = document.getElementById('export-tbody');
            const exportTimestamp = document.getElementById('export-timestamp');
            
            // X√≥a d·ªØ li·ªáu c≈©
            exportTable.innerHTML = '';
            
            // T·∫°o timestamp
            exportTimestamp.textContent = `T·ªïng h·ª£p l√∫c: ${new Date().toLocaleString('vi-VN')}`;
            
            // T·ªïng h·ª£p d·ªØ li·ªáu
            for (const [sourceKey, sourceData] of Object.entries(receivedData)) {
                if (sourceData && sourceData.data) {
                    const sourceName = sourceKey === 'lichtrinhcanhan' ? 'L·ªãch tr√¨nh c√° nh√¢n' : 'TKBNK 2526HS';
                    
                    for (const [key, value] of Object.entries(sourceData.data)) {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${sourceName}</td>
                            <td>${key}</td>
                            <td>${value}</td>
                        `;
                        exportTable.appendChild(row);
                    }
                }
            }
            
            // Hi·ªÉn th·ªã v√πng xu·∫•t
            exportArea.style.display = 'block';
            exportArea.scrollIntoView({ behavior: 'smooth' });
        });

        // X·ª≠ l√Ω xu·∫•t PNG
        document.getElementById('btn-export').addEventListener('click', async function() {
            const exportArea = document.getElementById('export-area');
            const button = this;
            
            if (exportArea.style.display === 'none') {
                alert('Vui l√≤ng nh·∫•n "T·ªïng h·ª£p l·∫°i" tr∆∞·ªõc khi xu·∫•t PNG');
                return;
            }
            
            button.disabled = true;
            button.innerHTML = '‚è≥ ƒêang xu·∫•t...';
            
            try {
                const canvas = await html2canvas(exportArea, {
                    backgroundColor: '#ffffff',
                    scale: 2,
                    logging: false,
                    useCORS: true
                });
                
                // T·∫°o link t·∫£i xu·ªëng
                const link = document.createElement('a');
                const filename = window.elementSdk?.config?.export_filename || defaultConfig.export_filename;
                link.download = `${filename}-${Date.now()}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                button.innerHTML = '‚úÖ ƒê√£ xu·∫•t!';
                setTimeout(() => {
                    button.innerHTML = 'üì∏ Xu·∫•t PNG';
                    button.disabled = false;
                }, 2000);
                
            } catch (error) {
                console.error('L·ªói khi xu·∫•t PNG:', error);
                button.innerHTML = '‚ùå L·ªói xu·∫•t';
                setTimeout(() => {
                    button.innerHTML = 'üì∏ Xu·∫•t PNG';
                    button.disabled = false;
                }, 2000);
            }
        });

        // X·ª≠ l√Ω t·∫£i file JSON th·ªß c√¥ng
        document.getElementById('file-lichtrinhcanhan').addEventListener('change', function(e) {
            handleFileUpload(e, 'lichtrinhcanhan');
        });

        document.getElementById('file-tkbnk2526hs').addEventListener('change', function(e) {
            handleFileUpload(e, 'tkbnk2526hs');
        });

        function handleFileUpload(event, source) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // T·∫°o message gi·∫£ l·∫≠p
                    const message = {
                        type: 'TKB_DATA',
                        source: source,
                        url: 'manual-upload',
                        timestamp: Date.now(),
                        data: data
                    };
                    
                    // X·ª≠ l√Ω nh∆∞ tin nh·∫Øn th√¥ng th∆∞·ªùng
                    receivedData[source] = message;
                    updateStatus(source, true);
                    updatePreview(source, data, message.timestamp);
                    updateControls();
                    
                } catch (error) {
                    alert('L·ªói ƒë·ªçc file JSON: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        // Kh·ªüi t·∫°o ·ª©ng d·ª•ng
        document.addEventListener('DOMContentLoaded', function() {
            initializeSDK();
            updateControls();
        });
    </script><button id="send-to-aggregator" style="padding: 12px 24px; background: #007bff; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer;"> üì§ G·ª≠i sang T·ªïng h·ª£p </button>
  <script>
document.getElementById('send-to-aggregator').addEventListener('click', function() {
    const SOURCE_ID = 'lichtrinhcanhan';
    const TARGET_ORIGIN = 'https://nckhthptnk.github.io';
    
    // Qu√©t to√†n b·ªô input, select, textarea
    const formData = {};
    
    // Input fields
    document.querySelectorAll('input').forEach(input => {
        if (input.type === 'checkbox' || input.type === 'radio') {
            if (input.checked) {
                formData[input.name || input.id || `input_${Math.random()}`] = input.value || 'checked';
            }
        } else {
            formData[input.name || input.id || `input_${Math.random()}`] = input.value;
        }
    });
    
    // Select fields
    document.querySelectorAll('select').forEach(select => {
        formData[select.name || select.id || `select_${Math.random()}`] = select.value;
    });
    
    // Textarea fields
    document.querySelectorAll('textarea').forEach(textarea => {
        formData[textarea.name || textarea.id || `textarea_${Math.random()}`] = textarea.value;
    });
    
    // T·∫°o g√≥i tin
    const message = {
        type: 'TKB_DATA',
        source: SOURCE_ID,
        url: window.location.href,
        timestamp: Date.now(),
        data: formData
    };
    
    // G·ª≠i ƒë·∫øn aggregator
    const aggregatorWindow = window.open('https://nckhthptnk.github.io/tonghop/', '_blank');
    
    // ƒê·ª£i trang t·∫£i xong r·ªìi g·ª≠i tin nh·∫Øn
    setTimeout(() => {
        aggregatorWindow.postMessage(message, TARGET_ORIGIN);
    }, 2000);
    
    // Th√¥ng b√°o th√†nh c√¥ng
    this.innerHTML = '‚úÖ ƒê√£ g·ª≠i!';
    this.style.background = '#28a745';
    setTimeout(() => {
        this.innerHTML = 'üì§ G·ª≠i sang T·ªïng h·ª£p';
        this.style.background = '#007bff';
    }, 3000);
});
</script><button id="send-to-aggregator" style="padding: 12px 24px; background: #007bff; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer;"> üì§ G·ª≠i sang T·ªïng h·ª£p </button>
  <script>
document.getElementById('send-to-aggregator').addEventListener('click', function() {
    const SOURCE_ID = 'tkbnk2526hs';
    const TARGET_ORIGIN = 'https://nckhthptnk.github.io';
    
    // Qu√©t to√†n b·ªô input, select, textarea
    const formData = {};
    
    // Input fields
    document.querySelectorAll('input').forEach(input => {
        if (input.type === 'checkbox' || input.type === 'radio') {
            if (input.checked) {
                formData[input.name || input.id || `input_${Math.random()}`] = input.value || 'checked';
            }
        } else {
            formData[input.name || input.id || `input_${Math.random()}`] = input.value;
        }
    });
    
    // Select fields
    document.querySelectorAll('select').forEach(select => {
        formData[select.name || select.id || `select_${Math.random()}`] = select.value;
    });
    
    // Textarea fields
    document.querySelectorAll('textarea').forEach(textarea => {
        formData[textarea.name || textarea.id || `textarea_${Math.random()}`] = textarea.value;
    });
    
    // T·∫°o g√≥i tin
    const message = {
        type: 'TKB_DATA',
        source: SOURCE_ID,
        url: window.location.href,
        timestamp: Date.now(),
        data: formData
    };
    
    // G·ª≠i ƒë·∫øn aggregator
    const aggregatorWindow = window.open('https://nckhthptnk.github.io/tonghop/', '_blank');
    
    // ƒê·ª£i trang t·∫£i xong r·ªìi g·ª≠i tin nh·∫Øn
    setTimeout(() => {
        aggregatorWindow.postMessage(message, TARGET_ORIGIN);
    }, 2000);
    
    // Th√¥ng b√°o th√†nh c√¥ng
    this.innerHTML = '‚úÖ ƒê√£ g·ª≠i!';
    this.style.background = '#28a745';
    setTimeout(() => {
        this.innerHTML = 'üì§ G·ª≠i sang T·ªïng h·ª£p';
        this.style.background = '#007bff';
    }, 3000);
});
</script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9968dd4237278b94',t:'MTc2MTgwNTgyOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>